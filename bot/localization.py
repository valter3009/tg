"""
–°–∏—Å—Ç–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è GidMeteo –±–æ—Ç–∞
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ (ru) –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ (en) —è–∑—ã–∫–æ–≤

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –°–æ–≤–µ—Ç—ã –ø–æ –æ–¥–µ–∂–¥–µ (clothes_advice) –ø–æ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
"""

TRANSLATIONS = {
    'ru': {
        # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
        'error_occurred': "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
        'error_registration': "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
        'error_start': "–û—à–∏–±–∫–∞. –ù–∞—á–Ω–∏—Ç–µ —Å /start",
        'error_getting_weather': "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≥–æ–¥—ã",
        'error_adding': "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏",
        'error_deleting': "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏",
        'error_refresh': "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏",

        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        'welcome_text': "–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –∏ —è —Å–∫–∞–∂—É –∫–∞–∫–∞—è —Ç–∞–º –ø–æ–≥–æ–¥–∞ –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –¥–∞–º —Å–æ–≤–µ—Ç—ã –ø–æ –æ–¥–µ–∂–¥–µ.\n\nüí° –û—Ç–ø—Ä–∞–≤–ª—è–π –ø—Ä–æ–≥–Ω–æ–∑—ã –≤ –ª—é–±–æ–π —á–∞—Ç: –≤–≤–µ–¥–∏ @MeteoblueBot + –≥–æ—Ä–æ–¥ –≤ –ª—é–±–æ–º —á–∞—Ç–µ –¢–µ–ª–µ–≥—Ä–∞–º",
        'welcome_with_cities': "\n\n–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –∏ —è —Å–∫–∞–∂—É –∫–∞–∫–∞—è —Ç–∞–º –ø–æ–≥–æ–¥–∞ –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –¥–∞–º —Å–æ–≤–µ—Ç—ã –ø–æ –æ–¥–µ–∂–¥–µ.\n\nüí° –û—Ç–ø—Ä–∞–≤–ª—è–π –ø—Ä–æ–≥–Ω–æ–∑—ã –≤ –ª—é–±–æ–π —á–∞—Ç: –≤–≤–µ–¥–∏ @MeteoblueBot + –≥–æ—Ä–æ–¥ –≤ –ª—é–±–æ–º —á–∞—Ç–µ –¢–µ–ª–µ–≥—Ä–∞–º",

        # –ö–Ω–æ–ø–∫–∏
        'btn_refresh': "üîÑ –û–±–Ω–æ–≤–∏—Ç—å",
        'btn_back': "‚óÄÔ∏è –ù–∞–∑–∞–¥",
        'btn_delete_city': "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≥–æ—Ä–æ–¥",
        'btn_add_favorite': "‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ",
        'btn_switch_to_en': "EN",
        'btn_switch_to_ru': "RU",

        # –°–æ–æ–±—â–µ–Ω–∏—è –æ –≥–æ—Ä–æ–¥–∞—Ö
        'city_not_found': "‚ùå –ì–æ—Ä–æ–¥ '{city}' –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è.",
        'local_time': "üïê –ú–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è:",
        'temperature': "üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:",
        'wind': "üí® –í–µ—Ç–µ—Ä:",

        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        'stats_title': "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞\n\n",
        'stats_total_users': "üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:",
        'stats_active': "‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö:",
        'stats_inactive': "‚ùå –ù–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö:",
        'stats_with_cities': "üèôÔ∏è –° –≥–æ—Ä–æ–¥–∞–º–∏:",
        'stats_without_cities': "üö´ –ë–µ–∑ –≥–æ—Ä–æ–¥–æ–≤:",
        'stats_activity_7days': "üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 7 –¥–Ω–µ–π:",
        'stats_no_activity': "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",
        'stats_error': "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
        'stats_error_msg': "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:",

        # Callback —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        'updated': "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ",
        'weather_updated': "‚úÖ –ü–æ–≥–æ–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞",
        'language_switched': "‚úÖ –Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ —Ä—É—Å—Å–∫–∏–π",

        # Inline –∑–∞–ø—Ä–æ—Å—ã
        'inline_hint_title': "üå§Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞",
        'inline_hint_description': "–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã",
        'inline_hint_message': "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ @gidmeteo_bot <–Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞> –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã",
        'inline_city_not_found': "‚ùå –ì–æ—Ä–æ–¥ \"{city}\" –Ω–µ –Ω–∞–π–¥–µ–Ω",
        'inline_check_spelling': "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è",
        'inline_city_not_found_msg': "–ì–æ—Ä–æ–¥ \"{city}\" –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è.",
        'inline_error': "‚ùå –û—à–∏–±–∫–∞",
        'inline_error_description': "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≥–æ–¥—ã",
        'inline_error_msg': "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≥–æ–¥—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
    },

    'en': {
        # Basic commands
        'error_occurred': "An error occurred. Please try again later.",
        'error_registration': "Error registering user. Please try again later.",
        'error_start': "Error. Start with /start",
        'error_getting_weather': "‚ùå Error getting weather",
        'error_adding': "Error adding",
        'error_deleting': "Error deleting",
        'error_refresh': "Error refreshing",

        # Welcome message
        'welcome_text': "Send me a city name and I'll tell you the weather and temperature there, and give you clothing advice.\n\nüí° Share forecasts in any chat: type @MeteoblueBot + city in any Telegram chat",
        'welcome_with_cities': "\n\nSend me a city name and I'll tell you the weather and temperature there, and give you clothing advice.\n\nüí° Share forecasts in any chat: type @MeteoblueBot + city in any Telegram chat",

        # Buttons
        'btn_refresh': "üîÑ Refresh",
        'btn_back': "‚óÄÔ∏è Back",
        'btn_delete_city': "üóëÔ∏è Delete city",
        'btn_add_favorite': "‚ûï Add to favorites",
        'btn_switch_to_en': "EN",
        'btn_switch_to_ru': "RU",

        # City messages
        'city_not_found': "‚ùå City '{city}' not found. Please check the spelling.",
        'local_time': "üïê Local time:",
        'temperature': "üå°Ô∏è Temperature:",
        'wind': "üí® Wind:",

        # Statistics
        'stats_title': "üìä Bot Statistics\n\n",
        'stats_total_users': "üë• Total users:",
        'stats_active': "‚úÖ Active:",
        'stats_inactive': "‚ùå Inactive:",
        'stats_with_cities': "üèôÔ∏è With cities:",
        'stats_without_cities': "üö´ Without cities:",
        'stats_activity_7days': "üìà Activity in 7 days:",
        'stats_no_activity': "No activity in the last 7 days",
        'stats_error': "‚ö†Ô∏è Failed to get user statistics",
        'stats_error_msg': "Error getting statistics:",

        # Callback notifications
        'updated': "‚úÖ Updated",
        'weather_updated': "‚úÖ Weather updated",
        'language_switched': "‚úÖ Language changed to English",

        # Inline queries
        'inline_hint_title': "üå§Ô∏è Enter city name",
        'inline_hint_description': "Start typing a city name to get weather",
        'inline_hint_message': "Use @gidmeteo_bot <city name> to get weather",
        'inline_city_not_found': "‚ùå City \"{city}\" not found",
        'inline_check_spelling': "Check the spelling",
        'inline_city_not_found_msg': "City \"{city}\" not found. Please check the spelling.",
        'inline_error': "‚ùå Error",
        'inline_error_description': "An error occurred while getting weather",
        'inline_error_msg': "An error occurred while getting weather. Please try again later.",
    }
}


def get_text(lang: str, key: str, **kwargs) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

    Args:
        lang: –ö–æ–¥ —è–∑—ã–∫–∞ ('ru' –∏–ª–∏ 'en')
        key: –ö–ª—é—á –ø–µ—Ä–µ–≤–æ–¥–∞
        **kwargs: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, city='Moscow')

    Returns:
        –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    """
    # –ï—Å–ª–∏ —è–∑—ã–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä—É—Å—Å–∫–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    if lang not in TRANSLATIONS:
        lang = 'ru'

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ —Å–ª–æ–≤–∞—Ä—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤
    text = TRANSLATIONS[lang].get(key, TRANSLATIONS['ru'].get(key, key))

    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
    if kwargs:
        try:
            text = text.format(**kwargs)
        except KeyError:
            pass

    return text


def get_language_from_user(user) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —è–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Args:
        user: –û–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

    Returns:
        –ö–æ–¥ —è–∑—ã–∫–∞ ('ru' –∏–ª–∏ 'en')
    """
    if hasattr(user, 'language') and user.language:
        return user.language
    return 'ru'  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä—É—Å—Å–∫–∏–π
